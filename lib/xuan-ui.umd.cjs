(function(c,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(c=typeof globalThis<"u"?globalThis:c||self,e(c.xuanUI={},c.Vue))})(this,function(c,e){"use strict";const E=(l,n)=>{const r=l.__vccOpts||l;for(const[t,o]of n)r[t]=o;return r},T={name:"x-picture-to-char"};function D(l,n,r,t,o,d){return"picture-to-char"}const b=E(T,[["render",D]]),G="",w=E(Object.assign({name:"x-icon"},{props:{name:{type:String,defalut:""},class:{type:String,defalut:" "}},setup(l){const n=l,r=e.computed(()=>{let t=["iconfont",n.name];return n.class&&(t=[...t,...n.class.split(" ").filter(o=>o)]),t});return(t,o)=>(e.openBlock(),e.createElementBlock("i",e.mergeProps(t.$attr,{class:e.unref(r)}),null,16))}}),[["__scopeId","data-v-dcc68724"]]),Y="",I={class:"vtc-container"},V=["src","width","height"],M=["width","height"],B=E(Object.assign({name:"x-video-to-char"},{props:{canvasBC:{type:String,default:"#000"},sourceURL:{type:String,default:""},size:{type:Object,default:{width:200,height:400}},charList:{type:Array,default:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]},random:{type:Boolean,default:!0},colorful:{type:Boolean,default:!0}},setup(l){const n=l;e.useCssVars(a=>({"94dd5522":e.unref(z).height,b8d07f04:e.unref(z).width,"80921a46":n.canvasBC,"4456889f":l.canvasBC}));const r=e.ref(!1),t=e.ref(null),o=e.ref(null),d=e.ref(null),k=e.ref(null),L=e.ref(1);let C=null,m=null;const S=a=>{switch(a){case 0:t.value.play(),r.value=!0;break;case 1:t.value.pause(),r.value=!1;break}},P=a=>{const s=a.data,i=a.width,$=a.height,p=[];for(let u=0;u<$;u++){const _=[];for(let f=0;f<i;f++){const y=s[(i*u+f)*4+0],g=s[(i*u+f)*4+1],x=s[(i*u+f)*4+2],q=y*.299+x*.587+g*.114;_.push({gray:q,R:y,G:g,B:x})}p.push(_)}let h=n.charList;n.colorful||(h=["#","&","$","*","!","."," "]);let v=0;return p.map(u=>u.map(({gray:_,R:f,G:y,B:g})=>{let x=h[v];return!n.colorful||n.colorful&&n.random?x=h[Math.floor(_/256*h.length)]:x=h[v],v<h.length-1?v++:v=0,{txt:x,R:f,G:y,B:g}}))},F=()=>{m.clearRect(0,0,d.value.width,d.value.height),C.drawImage(t.value,0,0,o.value.width,o.value.height);const a=C.getImageData(0,0,o.value.width,o.value.height),s=P(a);s.forEach((i,$)=>{const p=Math.floor(d.value.width/i.length),h=Math.floor((n.size.height-s.length*p)/2);m.font=`${p}px arial`,i.forEach((v,u)=>{const{txt:_,R:f,G:y,B:g}=v;n.colorful?m.fillStyle=`rgb(${f},${y},${g})`:m.fillStyle="#000",m.fillText(_,p*u,p*$+h)})})},U=()=>{const a=s=>()=>{console.log(111),L.value=s};t.value.addEventListener("play",()=>{o.value.width=50,o.value.height=50/1.5*t.value.videoHeight/t.value.videoWidth,d.value.addEventListener("mouseenter",a("flex"),!1),k.value.addEventListener("mouseenter",a("flex"),!1),d.value.addEventListener("mouseout",a("none"),!1),k.value.addEventListener("mouseout",a("none"),!1),a("none")();const s=()=>{const i=new CustomEvent("render");t.value.dispatchEvent(i),!t.value.ended&&!t.value.paused&&requestAnimationFrame(s)};requestAnimationFrame(s)},!1),t.value.addEventListener("render",()=>{F()},!1),t.value.addEventListener("ended",()=>{d.value.removeEventListener("mouseenter",a("flex"),!1),k.value.removeEventListener("mouseenter",a("flex"),!1),d.value.removeEventListener("mouseout",a("none"),!1),k.value.removeEventListener("mouseout",a("none"),!1),r.value=!1,a("flex")()},!1),m=d.value.getContext("2d"),C=o.value.getContext("2d"),t.value.crossOrigin="",t.value.setAttribute("webkit-playsinline","webkit-playsinline"),t.value.setAttribute("playsinline","playsinline")};e.onMounted(()=>{U()});const z=e.computed(()=>({width:n.size.width+"px",height:n.size.height+"px"}));return(a,s)=>(e.openBlock(),e.createElementBlock("div",I,[e.createElementVNode("video",{class:"player",ref_key:"player",ref:t,src:l.sourceURL,width:l.size.width,height:l.size.height,onEnded:s[0]||(s[0]=i=>r.value=!1)},null,40,V),e.createElementVNode("canvas",{ref_key:"handleDataCanvas",ref:o,style:{display:"none"}},null,512),e.createElementVNode("canvas",{ref_key:"displayCanvas",ref:d,class:"displayCanvas",width:l.size.width,height:l.size.height},null,8,M),e.createElementVNode("div",{class:"mask",ref_key:"mask",ref:k,style:e.normalizeStyle({display:L.value})},[r.value?(e.openBlock(),e.createBlock(e.unref(w),{key:1,name:"icon-24gf-pauseCircle",onClick:s[2]||(s[2]=i=>S(1)),class:"controls"})):(e.openBlock(),e.createBlock(e.unref(w),{key:0,name:"icon-24gf-play",onClick:s[1]||(s[1]=i=>S(0)),class:"controls"}))],4)]))}}),[["__scopeId","data-v-6a4911bb"]]),N=[b,B,w],O={install:l=>{N.forEach(n=>{l.component(n.name,n)})}},A=b,R=B,j=w;c.default=O,c.pictureToChar=A,c.videoToChar=R,c.xIcon=j,Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
